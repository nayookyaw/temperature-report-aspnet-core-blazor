@using Frontend.Constants
@using Microsoft.JSInterop
@inject IJSRuntime JS
@inject IConfiguration Config

<div id="@_mapId" class="map-host"></div>

@code {
  private string _mapId = $"map-{Guid.NewGuid():N}";
  private bool _initialized = false;

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (!firstRender || _initialized) return;
    _initialized = true;
    string backendBase = Config["BackendBase"] ?? "";
    await JS.InvokeVoidAsync("SensorMapbox.init", _mapId, new {
      backendBase,
      center = AppConstants.DEFAULT_COORDINATE, // Auckland as default center
      zoom = AppConstants.DEFAULT_ZOOM
    });
  }

  public async Task FlyToAsync(double lng, double lat, int? zoom = null)
  {
    await JS.InvokeVoidAsync("SensorMapbox.flyTo", lng, lat, zoom);
  }
}